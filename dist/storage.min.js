function checkBrowserSupport(e){if("indexedDB"===e){if(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,!window.indexedDB)throw new Error("Browser doesn't support IndexedDB")}else if(!window[e])throw new Error(`${e} type not supported`);return!0}function getProps(e){const o={};for(let t in window[e])window[e].hasOwnProperty(t)&&(o[t]=JSON.parse(window[e][t]));return o}function asyncCallback(e,o){if(e)return setTimeout(function(){e(o)},0),!0}function openIDB(e,o){return new Promise((t,r)=>{const n=indexedDB.open(e,o);let s;n.onsuccess=(()=>{s=n.result,t(s)}),n.onerror=(()=>{s=n.result,r(s)}),n.onupgradeneeded=(()=>{(s=n.result).objectStoreNames.contains("store")||s.createObjectStore("store")})})}function addItemToDB(e,o){return new Promise((t,r)=>{Storage._IDB_CONNECTION.then(n=>{const s=n.transaction("store","readwrite").objectStore("store").put(o,e);s.onerror=(()=>{console.log(new Error(Storage._IDB_CONNECTION.error.name)),r(s.result)}),s.onsuccess=(()=>{t(s.result)})})})}function getItemFromDB(e){return new Promise((o,t)=>{Storage._IDB_CONNECTION.then(r=>{const n=r.transaction("store","readonly").objectStore("store").get(e);n.onerror=(()=>{console.log(new Error(Storage._IDB_CONNECTION.error.name)),t(n.result)}),n.onsuccess=(()=>{o(n.result)})})})}function getAllValuesFromDB(){return new Promise((e,o)=>{Storage._IDB_CONNECTION.then(t=>{const r=t.transaction("store","readonly").objectStore("store").getAll();r.onerror=(()=>{console.log(new Error(Storage._IDB_CONNECTION.error.name)),o(r.result)}),r.onsuccess=(()=>{e(r.result)})})})}function getAllKeysFromDB(){return new Promise((e,o)=>{Storage._IDB_CONNECTION.then(t=>{const r=t.transaction("store","readonly").objectStore("store").getAllKeys();r.onerror=(()=>{console.log(new Error(Storage._IDB_CONNECTION.error.name)),o(r.result)}),r.onsuccess=(()=>{e(r.result)})})})}function uniteKeysAndValues(e,o){const t={};for(let r=0;r<e.length;r++)t[e[r]]=o[r];return t}function dataURItoBlob(e){const o=atob(e.split(",")[1]),t=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(o.length),n=new Uint8Array(r);for(let e=0;e<o.length;e++)n[e]=o.charCodeAt(e);return new Blob([r],{type:t})}function getFunc(e,o,t){let r;if(o||(o="localStorage"),checkBrowserSupport(o))return"indexedDB"===o?"function"==typeof t?getItemFromDB(e).then(e=>{t(r=e)}):console.log(new Error("Callback param required")):("blob"===(r=JSON.parse(window[o][e])).type&&(r=dataURItoBlob(r.text)),asyncCallback(t,r)),r}function getAllFunc(e,o){let t,r,n;if(e||(e="localStorage"),checkBrowserSupport(e)){if("indexedDB"===e)"function"==typeof o?(getAllValuesFromDB().then(e=>{r=e}),getAllKeysFromDB().then(e=>{t=uniteKeysAndValues(n=e,r),o(t)})):console.log(new Error("Callback param required"));else{t=getProps(e);for(const e in t)"blob"===t[e].type&&(t[e]=dataURItoBlob(t[e].text));asyncCallback(o,t)}return t}}function saveFunc(e,o,t,r){let n;const s=new FileReader;t||(t="localStorage"),checkBrowserSupport(t)&&("indexedDB"===t?"function"==typeof r?o instanceof Blob?(s.readAsDataURL(o),s.addEventListener("loadend",t=>{addItemToDB(e,o).then(()=>{r()})})):addItemToDB(e,o).then(()=>{r()}):console.log(new Error("Callback param required")):o instanceof Blob?(s.readAsDataURL(o),s.addEventListener("loadend",o=>{const s={text:o.target.result,type:"blob"};n=JSON.stringify(s),window[t].setItem(e,n),asyncCallback(r)})):(n="string"!=typeof o?JSON.stringify(o):o,window[t].setItem(e,n),asyncCallback(r)))}const Storage={save:saveFunc,get:getFunc,getAll:getAllFunc,LOCAL_STORAGE:"localStorage",SESSION_STORAGE:"sessionStorage",INDEXED_DB:"indexedDB",_IDB_CONNECTION:openIDB("db",1)};